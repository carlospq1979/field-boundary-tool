<!DOCTYPE html>
<html>
  <head>
    <title>Delineate Your Field </title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 500px;
        width: 100%;
      }
      form {
        padding: 20px;
        background: #f7f7f7;
      }
      input, textarea, button {
        width: 100%;
        margin: 8px 0;
        padding: 10px;
        font-size: 1em;
      }
      button {
        background: #2c7efc;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2 style="text-align:center;"> Navigate to your field and click on the corners to delineate a polygon </h2>
    <h2 style="text-align:center;"> Change to Satellite view (upper left of the map) if needed </h2>
    <h2 style="text-align:center;"> Complete the form below and submit </h2>
    <div id="map"></div>
    <form id="boundaryForm" action="https://formspree.io/f/xblpvkba" method="POST">
      <input type="text" name="name" placeholder="Your Name" required />
      <input type="email" name="email" placeholder="Your Email" required />
      <textarea name="notes" placeholder="Notes (e.g., crop type, field name)"></textarea>
      <input type="hidden" id="coordinates" name="coordinates" />
      <button type="submit">Submit Boundary</button>
    </form>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUeWkGBzc_1rN8JvTJYzOgLsI00SVx8o4&libraries=drawing"></script>
    <script>
      let map, drawingManager, selectedShape;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 33.5779, lng: -101.8552 }, // Example: Lubbock, TX
          zoom: 6,
        });

        drawingManager = new google.maps.drawing.DrawingManager({
          drawingMode: google.maps.drawing.OverlayType.POLYGON,
          drawingControl: true,
          drawingControlOptions: {
            position: google.maps.ControlPosition.TOP_CENTER,
            drawingModes: ["polygon"],
          },
        });

        drawingManager.setMap(map);

        google.maps.event.addListener(drawingManager, "overlaycomplete", function (event) {
          if (selectedShape) selectedShape.setMap(null);
          selectedShape = event.overlay;
          drawingManager.setDrawingMode(null);

          const path = selectedShape
            .getPath()
            .getArray()
            .map(p => ({ lat: p.lat(), lng: p.lng() }));
          document.getElementById("coordinates").value = JSON.stringify(path);
        });
      }

      window.onload = initMap;
    </script>
  </body>
</html>
